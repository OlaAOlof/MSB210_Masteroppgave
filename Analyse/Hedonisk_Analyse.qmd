---
title: "Masteroppgave"
author: 
  Kevin Ha
  Ola Andre Olofsson
format: html
editor: visual
---

# NB: FØR ME STARTE/GÅR VIDARE MED DETTA:

Me må bli enige om ka me gjere med dei 3-5 observasjonane som shady (negativ alder og 240000 m\^2 tomt observasjonane), då desse vil påvirka resultatene av analysane våras!

# Setup Chunk

```{r setup_base}
library(readr)
library(tidyverse)
library(dplyr)
library(lubridate)
#library(zoo)
library(sf)
library(sp)
library(spdep)
library(tmap)
library(spatialreg)
#library(magrittr)
#library(measurements)
library(tibble)
library(ggcorrplot)
library(huxtable)
options(paged.print = FALSE)
```

# Leser inn datasettene for analyse

```{r}
Analyse <- suppressWarnings(read_csv("Datasett_Analyse.csv")) %>% 
  select(-...1)
Analyse_sf <- suppressWarnings(st_read("Datasett_Analyse_sf.gpkg"))
```

# Summary av Datasettene

NOTE: Summary vil av ein elle anna grunn ikkje skriva ut i dokumentet. Får bare resultatet i "console". Må finna ut koffor.

```{r}
#summary(Analyse)
#summary(Analyse_sf)
```

# Lager vektmatriser

```{r}
#Analyse_mat_nb3 <- knearneigh(Analyse, k = 3)
#Analyse_nb3 <- knn2nb(Analyse_mat_nb3)
#Analyse_W3 <- nb2listw(Analyse_nb3, style = "W")
```

## Vektmatrise for Analyse_sf

### Vektmatrise, K = 3

```{r}
Analyse_sf_mat_nb3 <- knearneigh(Analyse_sf, k = 3)
Analyse_sf_nb3 <- knn2nb(Analyse_sf_mat_nb3)
Analyse_sf_W3 <- nb2listw(Analyse_sf_nb3, style = "W")
```

### Vektmatrise, K = 5

```{r}
Analyse_sf_mat_nb5 <- knearneigh(Analyse_sf, k = 5)
Analyse_sf_nb5 <- knn2nb(Analyse_sf_mat_nb5)
Analyse_sf_W5 <- nb2listw(Analyse_sf_nb5, style = "W")
```

### Vektmatrise, K = 10

```{r}
Analyse_sf_mat_nb10 <- knearneigh(Analyse_sf, k = 10)
Analyse_sf_nb10 <- knn2nb(Analyse_sf_mat_nb10)
Analyse_sf_W10 <- nb2listw(Analyse_sf_nb10, style = "W")
```

# Lager modeller

## Modell 1

```{r}
mod1 <- "P ~ EL.Kar + O.Karak + MatValg"
```

## Modell 2

Punkt 1: Fårkje kjørt modell på avstands-variabel (dist_cbd_km). Må finne ut av denne!

Punkt 2: Vi må finne ut kva variablar vi må ha "ln" framfor og kva variablar vi skal ha "I" framfor for å beholde formatering.

```{r}
#Fant problemet: Kan ikkje ta variabel BRA.Annet i SF_datasett, grunna alle verdiane e 0
mod2 <- "P ~ Alder + BLEnergikWh + Oms.Typ + BolType + AntEiendom + EiendomAreal + VannkantGL + VegkantGL + RegLBE + RegGrunnforur + RegKulturEiendom + RegGrunnerverv + RegBoDrivePlikt + TotBoliger + BRA.Bolig + BRA.Tot + BebygdAreal + RegKulturByg + Etasje + Lopenr + Bruksareal.Enhet + AntallRom + AntallBad + AntallWC + PrivatEid + HarHeis + EtasjeSeksjon + Kjokken + VannKode + AvlopsKode + YearQuarter"
```

## Modell 3

Punkt 1: Fårkje kjørt modell på avstands-variabel (dist_cbd_km). Må finne ut av denne!

Punkt 2: Vi må finne ut kva variablar vi må ha "ln" framfor og kva variablar vi skal ha "I" framfor for å beholde formatering.

```{r}
mod3 <- "P ~ Alder + EL.Kar + O.Karak + BLEnergikWh + MatValg + Oms.Typ + BolType + AntEiendom + EiendomAreal + VannkantGL + VegkantGL + RegLBE + RegGrunnforur + RegKulturEiendom + RegGrunnerverv + RegBoDrivePlikt + TotBoliger + BRA.Bolig + BRA.Tot + BebygdAreal + RegKulturByg + Etasje + Lopenr + Bruksareal.Enhet + AntallRom + AntallBad + AntallWC + PrivatEid + HarHeis + EtasjeSeksjon + Kjokken + VannKode + AvlopsKode + YearQuarter + dist_cbd_km"
```

## Modell 4

```{r}
mod4 <- "P ~ EL.Kar"
```

# Kjører OLS-Modellen på våres modeller

## OLS1

Her på energi karakter: Trur vi her må gjere det Liv snakka om, med å utelukke ein energikarakter i modellen (forslaget var utelukke Energi karkater A), for å sjekke korleis den andre energi karakterer slår ut, opp mot denne.

Problemet: Eg er ikkje heilt sikker på korleis vi gjer dette i R.

```{r}
OLS1 = lm(mod1, data = Analyse_sf)
```

```{r}
summary(OLS1)
```

Dette er ein problemstilling som vil forplante seg vidare i dei andre modellane, som inkluderer energikarakterer og lignande. Dette må vi løyse.

## OLS2

Punkt 1: Fårkje kjørt modell på avstands-variabel (dist_cbd_km). Må finne ut av denne!

Punkt 2: Vi må finne ut kva variablar vi må ha "ln" framfor og kva variablar vi skal ha "I" framfor for å beholde formatering.

```{r}
OLS2 = lm(mod2, data = Analyse_sf)
```

```{r}
summary(OLS2)
```

## OLS3

Punkt 1: Fårkje kjørt modell på avstands-variabel (dist_cbd_km). Må finne ut av denne!

Punkt 2: Vi må finne ut kva variablar vi må ha "ln" framfor og kva variablar vi skal ha "I" framfor for å beholde formatering.

```{r}
OLS3 = lm(mod3, data = Analyse_sf)
```

```{r}
summary(OLS3)
```

## OLS4

```{r}
#OLS4 = lm(mod4, data = Analyse_sf)
```

```{r}
#summary(OLS4)
```

# HuxReg av OLS-modeller

```{r}
#Ekje heilt oppe å går endo. Jobbe med da.

#huxreg("OLS1" = OLS1, "OLS2" = OLS2, "OLS3" = OLS3,
#       error_format = "[{statistic}]",
#       note = "{stars}. T statistic in brackets.")
```

# Moran's Test

## Moran's - OLS1

```{r}
lm.morantest(OLS1, Analyse_sf_W3)
```

```{r}
lm.morantest(OLS1, Analyse_sf_W5)
```

```{r}
lm.morantest(OLS1, Analyse_sf_W10)
```

## Moran's - OLS2

```{r}
lm.morantest(OLS2, Analyse_sf_W3)
```

```{r}
lm.morantest(OLS2, Analyse_sf_W5)
```

```{r}
lm.morantest(OLS2, Analyse_sf_W10)
```

## Moran's - OLS3

```{r}
lm.morantest(OLS3, Analyse_sf_W3)
```

```{r}
lm.morantest(OLS3, Analyse_sf_W5)
```

```{r}
lm.morantest(OLS3, Analyse_sf_W10)
```

## Moran's OLS4

```{r}
cor_matrix <- cor(Analyse[c("P", "EL.Kar", "Alder", "B.Ar", "Etasje", "AntallRom")])

ggcorrplot(cor_matrix)
```

```{r}
correlation <- cor(Analyse$B.Ar, Analyse$AntallRom, method = "pearson")

print(correlation)
```

```{r}
cor_matrix <- cor(Analyse[c("P", "EL.Kar", "Alder", "Etasje", "AntallRom")])

ggcorrplot(cor_matrix, type = "lower", hc.order = TRUE, lab = TRUE)
```

```{r}
#Siste
```
